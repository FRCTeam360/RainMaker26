%% Shooting State Diagram (internal states while SHOOTING is active)
%% Parent state: SuperStructure.SHOOTING
%% Entry: Shoot toggled on | Exit: Shoot toggled off, Hopper empty, or Eject pressed
stateDiagram-v2
    [*] --> PREPARING

    %% Preparing to shoot
    PREPARING --> READY_TO_FIRE : Robot aligned AND<br>Flywheel at speed
    PREPARING --> [*] : SHOOTING (from SuperStructure) toggled off
    PREPARING --> [*] : Hopper empty

    %% Ready to fire
    READY_TO_FIRE --> FIRING : Aligned for<br>100ms (debounce)
    READY_TO_FIRE --> PREPARING : Alignment lost OR<br>Flywheel speed lost
    READY_TO_FIRE --> [*] : SHOOTING (from SuperStructure) toggled off

    %% Firing
    FIRING --> READY_TO_FIRE : Ball fired<br>(still have ammo)
    FIRING --> PREPARING : Alignment lost
    FIRING --> [*] : Hopper empty
    FIRING --> [*] : SHOOTING (from SuperStructure) toggled off

    note right of PREPARING : Spins up flywheel<br>Drivetrain aligns to target
    note right of READY_TO_FIRE : Flywheel ready<br>Waiting for stable alignment
    note right of FIRING : Feeds balls into shooter<br>Stops feeder if alignment lost
